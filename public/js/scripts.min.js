/*
 kubo 1.0.0 2018-04-17 
*/

function DashboardController(){this.user=user.authenticateUser(),document.getElementById("user").innerHTML=this.user.firstname,document.getElementById("profile-image-header").src=this.user.image,document.getElementById("profile-image-comment")&&(document.getElementById("profile-image-comment").src=this.user.image,document.getElementById("profile-user-comment").innerHTML=this.user.firstname+" "+this.user.lastname)}function Lessonplan(){DashboardController.call(this)}function ProfileController(){DashboardController.call(this)}function tabChangeContent(e,t){for(var s=document.getElementsByClassName("tab"),n=0;n<s.length;n++)s[n].classList.remove("active");if(e.currentTarget.classList.add("active"),t){var a=document.getElementsByClassName("tab-content");for(n=0;n<a.length;n++)a[n].classList.add("disabled"),a[n].classList.remove("active");var l=document.getElementById(t);l.classList.add("active"),l.classList.remove("disabled")}}function changeTraining(e){document.getElementById("video-player").src=e}function User(){}toggleAccordionItem=function(e){for(var t=e.parentNode.className,s=document.getElementById("accordion").getElementsByClassName("accordion-item"),n=0;n<s.length;n++)s[n].className="accordion-item close";"accordion-item close"==t&&(e.parentNode.className="accordion-item open")},DashboardController.prototype.setLatestsLessons=function(){var e=JSON.parse(localStorage.getItem("lessonPlans"));if(e){var t=document.createElement("div");t.className="container";for(var s=0,n=0;n<e.length;n++){var a=document.createElement("div");a.className="lesson";var l=e[n].image;if(l||(l="public/images/Coding-box-open-2.jpg"),a.innerHTML='<div class="inner" style="background-image: url(&quot;'+l+'&quot;)">          <div class="overlay"></div>          <div class="text">            <h3>'+e[n].title+"</h3>            <p>"+e[n].description.substring(0,110)+'...</p>            <a href="view-lessonplan.html" onclick="controller.setLessonplan('+e[n].id+')" class="btn btn-primary">View Lesson Plan</a>          </div>        </div>',t.appendChild(a),3==++s)break}document.getElementById("latest-lessons").appendChild(t)}},Lessonplan.prototype.addNewSection=function(){var e=document.getElementById("create-lesson"),t=document.createElement("div");t.className="section",t.innerHTML='<div class="input-control">      <label for="name">Section Title</label>      <input name="name" type="text" placeholder="Enter Section Title">    </div>    <div class="input-control">      <label for="textarea">Textarea</label>      <textarea name="textarea" id="textare" placeholder="Enter section content..."></textarea>    </div>    <hr class="divider">',e.appendChild(t)},Lessonplan.prototype.publish=function(){for(var e=document.forms["lesson-form"],t=document.forms["materials-select"],s=document.forms["meta-data"],n=[],a=0;a<e.length;a++)n.push(e.elements[a].value);lessonDataGrouped=[];for(a=0;a<n.length;a++)if((a+1)%2==0){var l={title:n[a-1],content:n[a]};lessonDataGrouped.push(l)}var o=[];for(a=0;a<s.length;a++)o.push(s.elements[a].value);var r=[];for(a=0;a<t.elements.length;a++){var i=t.elements[a];if(i.checked){var c={title:i.value,id:i.id};r.push(c)}}var m={title:o[0],image:o[1],description:o[2],materials:r,sections:lessonDataGrouped},d=[];if(localStorage.getItem("lessonPlans")){var u=JSON.parse(localStorage.getItem("lessonPlans"));for(a=0;a<u.length;a++)d.push(u[a])}m.id=d.length+1,m.author=this.user,d.unshift(m),localStorage.setItem("lessonPlans",JSON.stringify(d)),localStorage.setItem("openedLessonplan",JSON.stringify(m.id)),window.location="view-lessonplan.html"},Lessonplan.prototype.listLessons=function(e){var t=JSON.parse(localStorage.getItem("lessonPlans"));if(t)for(var s=0;s<t.length;s++){var n=document.createElement("div");n.className="lesson";var a=t[s].image;a||(a="public/images/Coding-box-open-2.jpg"),n.innerHTML='<div class="inner" style="background-image: url(&quot;'+a+'&quot;)">          <div class="overlay"></div>          <div class="text">            <h3>'+t[s].title+"</h3>            <p>"+t[s].description.substring(0,110)+'...</p>            <a href="view-lessonplan.html" onclick="controller.setLessonplan('+t[s].id+')" class="btn btn-primary">View Lesson Plan</a>          </div>        </div>',e.appendChild(n)}},Lessonplan.prototype.setLessonplan=function(e){localStorage.setItem("openedLessonplan",JSON.stringify(e))},Lessonplan.prototype.openLesson=function(e,t,s,n){var a=JSON.parse(localStorage.getItem("openedLessonplan"));a||(window.location="lessonplans.html");for(var l=JSON.parse(localStorage.getItem("lessonPlans")),o=0;o<l.length;o++)l[o].id==a&&this.showLesson(l[o],e,t,s,n)},Lessonplan.prototype.showLesson=function(e,t,s,n,a){n.innerHTML="<h1>"+e.title+"</h1><h3>by "+e.author.firstname+" "+e.author.lastname+"</h3>";var l=document.createElement("div");l.className="container",l.innerHTML='<div class="description">      <h3>About the Lesson</h3>      <p>'+e.description+"</p>    </div>";var o=document.createElement("div");o.className="materials",(n=document.createElement("h3")).innerHTML="Materials",o.appendChild(n);for(var r=0;r<e.materials.length;r++){var i=document.createElement("div");i.className="material",i.innerHTML='<img src="public/images/materials/'+e.materials[r].id+'.svg" alt="Dummy">       <span class="material-title">'+e.materials[r].title+"</span>",o.appendChild(i)}l.appendChild(o),t.appendChild(l);for(r=0;r<e.sections.length;r++){var c=document.createElement("div");c.className="accordion-item",0==r?c.classList.add("accordion-item","open"):c.classList.add("accordion-item","close"),c.innerHTML='<h2 class="accordion-heading" onclick="toggleAccordionItem(this)">        <span class="tactile"><span class="no">'+(r+1)+'</span><svg viewBox="0 0 100 100" xmlns="http:www.w3.org/2000/svg"><path d="M94.5 64.8c-.7-.7-2-.7-2.7 0l-.7-.7s-.7-.7 2.1-3.4l4-4c3.7-3.7 3.7-9.8 0-13.5l-6.5-6.5-.4.4s-.4.4-.1.8c.4.4.2 1.8-.8 2.8-.7.7-2 .7-2.8-.1l-4.3-4.3.1.1c-.9-.9-1-2.2-.3-3 1-1 2.4-1.2 3.1-.4l.4-.4s.4-.4-4-4.9L68.9 15s-1.4-1.4-.7-2c0 0-.7.7 0 0 0 0 .7-.7 1-.3s1.6.4 2.3-.4c.7-.7.7-2 0-2.7l-4-4c-.7-.7-2-.7-2.7 0s-.7 2 0 2.7l-.7.7s-.7.7-3.4-2.1l-4-4C53-.9 47-.9 43.3 2.8l-6.5 6.5.5.5.4.4c.7-.7 2.2-.5 3.1.4.7.7.7 2-.1 2.8l-4.2 4.2c-.9.9-2.2 1-3 .3-1-1-1.2-2.4-.4-3.1l-.4-.4s-.4-.4-4.9 4L13.6 32.5l-.6-.6-.4-.4s-.4-.4 0-.7c.4-.4.4-1.6-.4-2.3-.7-.7-2-.7-2.7 0l-4 4c-.7.7-.7 2 0 2.7s2 .7 2.7 0l1.3 1.3-1 1-5.8 5.8C-1 47-1 53.1 2.7 56.8l2.7 2.7 3.7 3.7.9-.9c-.7-.7-.5-2.2.4-3.1.7-.7 2-.7 2.8.1l1.4 1.4 2.9 2.9-.1-.1c.9.9 1 2.2.3 3-1 1-2.4 1.2-3.1.5l-.9.9L31.1 85s1.4 1.4.7 2c0 0 .7-.7 0 0 0 0-.7.7-1 .3-.4-.4-1.6-.4-2.3.4-.7.7-.7 2 0 2.7l4 4c.7.7 2 .7 2.7 0s.7-2 0-2.7l.7-.7s.7-.7 3.4 2.1l4 4c3.7 3.7 9.8 3.7 13.5 0l2.7-2.7 3.7-3.7-.9-.9c-.7.7-2.2.5-3.1-.4-.7-.7-.7-2 .1-2.8l4.3-4.3-.1.1c.9-.9 2.2-1 3-.3 1 1 1.2 2.4.4 3.1l.9.9L85 68.9s1.4-1.4 2-.7c0 0-.7-.7 0 0 0 0 .7.7.3 1s-.4 1.6.4 2.3c.7.7 2 .7 2.7 0l4-4c.9-.7.9-1.9.1-2.7"/></svg></span>        '+e.sections[r].title+'      </h2>      <div class="accordion-item-content">        '+e.sections[r].content+"      </div>",s.appendChild(c)}this.user.id==e.author.id&&(a.innerHTML='<button class="btn btn-success" onclick="controller.editLesson('+e.id+')">Edit Lesson</button>      <hr class="divider">'),document.title="KEDU | "+e.title},Lessonplan.prototype.editLesson=function(e){localStorage.setItem("editingLesson",JSON.stringify(e)),window.location="edit-lessonplan.html"},Lessonplan.prototype.editLessonplanPage=function(){for(var e=JSON.parse(localStorage.getItem("editingLesson")),t=JSON.parse(localStorage.getItem("lessonPlans")),s=0;s<t.length;s++)if(t[s].id==e){document.getElementById("lessonTitle").value=t[s].title,document.getElementById("lessonImage").value=t[s].image,document.getElementById("lessonDescription").value=t[s].description;var n=document.createElement("div");n.id="create-lesson",n.class="create-lesson";for(var a=0;a<t[s].materials.length;a++)document.getElementById(t[s].materials[a].id).checked=!0;for(var l=0;l<t[s].sections.length;l++){var o=t[s].sections[l],r=document.createElement("div");r.className="section",r.innerHTML='<div class="input-control">              <label for="name">Section Title</label>              <input name="name" type="text" value="'+o.title+'" placeholder="Enter Section Title..">            </div>            <div class="input-control">              <label for="textarea">Section Content</label>              <textarea name="textarea" id="textare" placeholder="Enter section content..">'+o.content+'</textarea>            </div>            <hr class="divider">',n.appendChild(r)}document.getElementById("lesson-form").appendChild(n);break}},Lessonplan.prototype.update=function(e){for(var t=document.forms["lesson-form"],s=document.forms["materials-select"],n=document.forms["meta-data"],a=[],l=0;l<t.length;l++)a.push(t.elements[l].value);lessonDataGrouped=[];for(l=0;l<a.length;l++)if((l+1)%2==0){var o={title:a[l-1],content:a[l]};lessonDataGrouped.push(o)}var r=[];for(l=0;l<n.length;l++)r.push(n.elements[l].value);var i={title:r[0],image:r[1],description:r[2],sections:lessonDataGrouped},c=[];if(localStorage.getItem("lessonPlans")){var m=JSON.parse(localStorage.getItem("lessonPlans"));for(l=0;l<m.length;l++)c.push(m[l])}var d=[];for(l=0;l<s.elements.length;l++){var u=s.elements[l];if(u.checked){var p={title:u.value,id:u.id};d.push(p)}}i.id=e,i.author=this.user,i.materials=d;for(l=0;l<c.length;l++)c[l].id==e&&c.splice(l,1);c.unshift(i),localStorage.setItem("lessonPlans",JSON.stringify(c)),localStorage.setItem("openedLessonplan",JSON.stringify(i.id)),window.location="view-lessonplan.html"},Lessonplan.prototype.delete=function(e){var t=[];if(localStorage.getItem("lessonPlans"))for(var s=JSON.parse(localStorage.getItem("lessonPlans")),n=0;n<s.length;n++)s[n].id==e?console.log(e+" slettet"):(console.log(e+" ikke slettet"),t.push(s[n]));localStorage.setItem("lessonPlans",JSON.stringify(t)),window.location="lessonplans.html"},ProfileController.prototype.setProfile=function(){var e=this.user.firstname+" "+this.user.lastname;document.getElementById("user-name").innerHTML=e;var t=this.user.school+", "+this.user.country;document.getElementById("school-name").innerHTML=t;var s=e+"'s latest lesson plans";document.getElementById("users-latest-lessons").innerHTML=s;var n=e+"'s latest community posts";document.getElementById("user-posts").innerHTML=n,document.getElementById("username-post1").innerHTML=e,document.getElementById("username-post2").innerHTML=e,document.getElementById("username-post3").innerHTML=e,document.getElementById("profile-image").src=this.user.image,this.showLessonPlans(this.user.id)},ProfileController.prototype.showLessonPlans=function(e){var t=JSON.parse(localStorage.getItem("lessonPlans"));if(t){var s=document.createElement("div");s.className="container";for(var n=0,a=0;a<t.length;a++){if(t[a].author.id==e){var l=document.createElement("div");l.className="lesson";var o=t[a].image;o||(o="public/images/Coding-box-open-2.jpg"),l.innerHTML='<div class="inner" style="background-image: url(&quot;'+o+'&quot;)">\t\t        <div class="overlay"></div>\t\t        <div class="text">\t\t          <h3>'+t[a].title+"</h3>\t\t          <p>"+t[a].description.substring(0,110)+'...</p>\t\t          <a href="view-lessonplan.html" onclick="controller.setLessonplan('+t[a].id+')" class="btn btn-primary">View Lesson Plan</a>\t\t        </div>\t\t      </div>',s.appendChild(l),n++}if(3==n)break}document.getElementById("user-lessons").appendChild(s)}},ProfileController.prototype.setFormFields=function(){for(var e=JSON.parse(localStorage.getItem("users")),t=0;t<e.length;t++)if(e[t].id==this.user.id){document.getElementById("firstname").value=e[t].firstname,document.getElementById("lastname").value=e[t].lastname,document.getElementById("school").value=e[t].school,document.getElementById("country").value=e[t].country,document.getElementById("email").value=e[t].email,document.getElementById("password").value=e[t].password,e[t].image&&"public/images/avatar.svg"!=e[t].image&&(document.getElementById("image").value=e[t].image);var s=this;document.getElementById("update-profile").addEventListener("submit",function(e){e.preventDefault();var t=this.elements;user.update(s.user.id,t)});break}},User.prototype.signup=function(){for(var e=document.forms["signup-form"],t=0,s=[],n=0;n<e.length-1;n++)""===e.elements[n].value?t++:s.push(e.elements[n].value);if(t)return alert("All fields has to be filled!"),!1;var a={firstname:s[0],lastname:s[1],image:"public/images/avatar.svg",school:s[2],country:s[3],email:s[4],password:s[5]};if(this.userExists(a.email))return alert("A user is already signed up with that email!"),!1;var l=[];if(localStorage.getItem("users")){var o=JSON.parse(localStorage.getItem("users"));for(n=0;n<o.length;n++)l.push(o[n])}return a.id=l.length+1,l.push(a),localStorage.setItem("users",JSON.stringify(l)),alert("User created! You can now login!"),document.getElementById("login-tab-button").click(),!1},User.prototype.signin=function(){for(var e=document.forms["signin-form"],t=0,s=[],n=0;n<e.length-1;n++)""===e.elements[n].value?t++:s.push(e.elements[n].value);if(t)return alert("Please provide your email and password to login."),!1;var a=this.lookupUser(s[0],s[1]);return a?(s={id:a.id,firstname:a.firstname,lastname:a.lastname,image:a.image,school:a.school,country:a.country,email:a.email},this.name=a.name,this.email=a.email,localStorage.setItem("auth",JSON.stringify(s)),location.href="dashboard.html"):alert("Could not find user with those credentials!"),!1},User.prototype.lookupUser=function(e,t){for(var s=JSON.parse(localStorage.getItem("users")),n=0;n<s.length;n++)if(s[n].email===e&&s[n].password===t)return s[n]},User.prototype.userExists=function(e){var t=JSON.parse(localStorage.getItem("users"));if(!t)return!1;for(var s=0;s<t.length;s++)return t[s].email===e},User.prototype.signout=function(){return localStorage.removeItem("auth"),!(window.location="index.html")},User.prototype.authenticateUser=function(){var e=JSON.parse(localStorage.getItem("auth"));return e||(window.location="index.html"),e},User.prototype.update=function(e,t){for(var s=[],n=0,a=0;a<t.length-1;a++)""==t[a].value&&"image"!=t[a].id?n++:s.push(t[a].value);if(n)alert("All fields should have an value except Profile Image!");else{var l=JSON.parse(localStorage.getItem("users"));for(a=0;a<l.length;a++)if(l[a].id==e){l.splice(a,1);break}""==s[2]&&(s[2]="public/images/avatar.svg");var o={id:e,firstname:s[0],lastname:s[1],image:s[2],school:s[3],country:s[4],email:s[5],password:s[6]};l.push(o),localStorage.setItem("users",JSON.stringify(l)),localStorage.setItem("auth",JSON.stringify({id:e,firstname:s[0],lastname:s[1],image:s[2],school:s[3],country:s[4],email:s[5]})),window.location="profile.html"}};var user=new User;function upVote(e){e.target.parentElement.classList.add("btn-clicked-upvote")}function downVote(e){e.target.parentElement.classList.add("btn-clicked-downvote")}